// File: database/seed.js
// ูุฐุง ุงูุณูุฑุจุช ูุฎุตุต ูุชุนุจุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจุงูุจูุงูุงุช ุงูุฃูููุฉ.
// ูุชู ุชุดุบููู ูุฑุฉ ูุงุญุฏุฉ ูุฏููุงู ุจุงุณุชุฎุฏุงู ุงูุฃูุฑ: npm run db:seed

import mongoose from 'mongoose';
import dotenv from 'dotenv';
import { initialPlaces } from './places-data.js'; // 1. ุงุณุชูุฑุงุฏ ุจูุงูุงุชูุง
import Place from '../api/models/place.model.js'; // 2. ุงุณุชูุฑุงุฏ ููุฏูู ุงูููุงู

// ุชุญููู ูุชุบูุฑุงุช ุงูุจูุฆุฉ ูู ููู .env
dotenv.config();

const seedDatabase = async () => {
    // 3. ุงูุชุญูู ูู ูุฌูุฏ ุฑุงุจุท ูุงุนุฏุฉ ุงูุจูุงูุงุช
    const mongoUri = process.env.MONGO_URI;
    if (!mongoUri) {
        console.error('๐ด ุฎุทุฃ: ูู ูุชู ุงูุนุซูุฑ ุนูู ุฑุงุจุท ูุงุนุฏุฉ ุงูุจูุงูุงุช (MONGO_URI) ูู ููู .env');
        process.exit(1); // ุงูุฎุฑูุฌ ูู ุงูุณูุฑุจุช ุฅุฐุง ูู ููุฌุฏ ุงูุฑุงุจุท
    }

    try {
        // 4. ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช
        await mongoose.connect(mongoUri);
        console.log('โ ุชู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุจูุงูุงุช MongoDB ุจูุฌุงุญ!');

        // 5. ุญุฐู ุฌููุน ุงูุฃูุงูู ุงูููุฌูุฏุฉ ูุชุฌูุจ ุงูุชูุฑุงุฑ
        await Place.deleteMany({});
        console.log('๐งน ุชู ุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ ูู ูุฌููุนุฉ ุงูุฃูุงูู.');

        // 6. ุฅุฏุฎุงู ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ูู ููู places-data.js
        await Place.insertMany(initialPlaces);
        console.log(`๐ ูุฌุงุญ! ุชู ุฅุถุงูุฉ ${initialPlaces.length} ููุงู ุฌุฏูุฏ ุฅูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.`);

    } catch (error) {
        console.error('๐ด ูุดู ูู ุชุนุจุฆุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช:', error);
    } finally {
        // 7. ุฅุบูุงู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช ูู ูู ุงูุฃุญูุงู
        await mongoose.connection.close();
        console.log('๐ ุชู ุฅุบูุงู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช.');
    }
};

// 8. ุชุดุบูู ุงูุฏุงูุฉ
seedDatabase();